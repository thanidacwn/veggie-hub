{% extends "base.html" %}
{% load static %}

{% block content %}
    <body style="font-family: Inter; hi">
        {% comment %} <link rel="stylesheet" href="{% static 'veggie/detail.css' %}"> {% endcomment %}
        {% if messages %}
            {% for message in messages %}
                <p style="color: orangered;"><strong>{{ message }}</strong></p>
            {% endfor %}
        {% endif %}
        <div class="grid grid-cols-2 gap-2 mt-10">
            <div class="inline-grid relative justify-center ml-10 h-[80vh] w-[40vw]">
                <div class="border border-gray-800 justify-center ml-10 h-[73vh] w-[40vw]">
                    <div class="absolute flex right-0 mt-4 bg-gray-300 rounded-3xl w-[14vw] h-[5vh] text-lg justify-center items-center mr-[1vw]">
                        Avg Star Rating: {{ restaurant.get_average_rate }}
                    </div>
                    <h1 class="text-3xl font-bold mt-[10vh] mb-[2vh] ml-[3vw]">{{ restaurant.restaurant_text }}</h1>
                    <img src="{{ restaurant.image }}" alt="Restaurant Image" class="w-[35vw] h-[35vh] ml-auto mr-auto rounded-xl">
                    <div class="w-[35vw] h-[35vh] ml-auto mr-auto mt-[2vh]">
                        <p class="text-xl mb-2">Location: {{ restaurant.location }}</p>
                        <p class="text-xl mb-2">Category: {{ restaurant.category }}</p>
                        <p class="text-xl mb-2">Price Rate: {{ restaurant.price_rate }}</p>
                        <p class="text-xl mb-2">Link: <a href={{restaurant.restaurant_link}}>Tripadvisor</a></p>
                    </div>
                </div>
                <a href="{% url 'veggie:index' %}">
                    <button class="absolute left-0 bottom-0 bg-gray-300 hover:bg-gray-400 text-xl py-2 px-4 rounded-full w-[30vh] h-[5.5vh] ml-5">
                        Back to Home
                    </button>
                </a>
            </div>
            <script>
                function createStarRating(restaurant) {
                    let stars = [];
                    for (let i = 1; i <= 5; i++) {
                        if (i > restaurant) {
                            stars.push('<span class="fa fa-star text-gray-400 text-xl"></span>')
                        } else {
                            stars.push('<span class="fa fa-star text-yellow-400 text-xl"></span>')
                        }
                    }
                    return stars;
                }
            </script>
            <div class="relative border border-gray-800 mr-10 h-[82vh] w-[45vw] overflow-y-scroll">
                <a href="{% url 'veggie:add_review' pk=restaurant.pk  %}">
                    <button class="absolute right-0 bg-gray-300 hover:bg-gray-400 text-xl py-2 px-4 rounded-full w-[12vw] h-[5vh] mt-[2vh] mr-[1.5vw]">
                        Add review
                    </button>
                </a>
                <h1 class="text-2xl mt-[2.5vh] ml-[2vw]">Reviews ({{ restaurant.get_reviews_amount }} reviews)</h1>
                {% for review in reviews %}
                    {% if review %}
                        <div class="relative border border-gray-800 rounded ml-[2vw] mr-[2vw] mt-[3vh] pl-[2vw] pr-[2vw]">
                            <img src="{% static 'veggie/images/user.png' %}" alt="" class="absolute w-11 mt-[2.5vh] mb-[2.5vh]">
                            <p class="absolute right-0 mt-[3vh] mr-[2vw]" id="{{review.pk}}"></p>
                            {% comment %} <p>Rating: {{ review.review_rate }}</p> {% endcomment %}
                            <script>
                                function renderStar() {
                                    let outputResult = document.getElementById('{{review.pk}}');
                                    outputResult.innerHTML = createStarRating({{review.review_rate}}).join('');
                                    console.log(createStarRating());
                                }
                                renderStar()
                            </script>
                            <p class="mt-[2.2vh] ml-[10vh]">{{ review.review_user }}</p>
                            <i class="mt-[2.2vh] ml-[10vh]">Reviewed on {{ review.review_date }}</i>
                            <h3 class="font-bold mt-[2vh] mb-[2vh]">{{ review.review_title }}</h3>
                            <p class="mb-[2vh]">{{ review.review_description }}</p>
                        </div>
                    {% else %}
                        <h2>
                            There are currently no review for this restaurant,
                            <a href="{% url 'veggie:add_review' pk=restaurant.pk  %}">Be first!</a>
                        </h2>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </body>
{% endblock %}
